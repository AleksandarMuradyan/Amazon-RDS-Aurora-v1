#!/bin/bash
#Copies the logs generated by pgbench into the table

LOG_PATH=/home/ec2-user/temp
TABLE_NAME=pgbenchstats

# Recreate the pgststats table
psql -d pgbenchtest -c "DROP TABLE IF EXISTS  pgbenchstats;"
psql -d pgbenchtest -c "CREATE TABLE pgbenchstats (client_id int, transaction_no int, time  int, script_no int, time_epoch int, time_us int);"



# Truncate the pgbenchstats table
# psql -d pgbenchtest -c "TRUNCATE TABLE $TABLE_NAME"

# get filenames
IMPFILES=($LOG_PATH/pgbench_log*)

# import the files
for PGBENCH_LOG_FILE in ${IMPFILES[@]}
    do
        echo "Processing: $fil"
        psql  -c "\copy $TABLE_NAME from '$PGBENCH_LOG_FILE' DELIMITER ' ' CSV" -d pgbenchtest
        # move the imported file
        # mv $i /FilePath
    done